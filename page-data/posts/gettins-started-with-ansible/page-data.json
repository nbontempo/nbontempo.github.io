{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/gettins-started-with-ansible","result":{"data":{"markdownRemark":{"id":"159cac9b-7de9-5b3d-bb68-ab1e01096db4","html":"<p>Ansible is a open source tool backed by red hat since 2015, that gives you the skill to control and configure multiple server from one single location. So, instead of having to go to each server and configure them, you can create automations with Ansible to do that for you. The benefits of Ansible are that:</p>\n<ul>\n<li>Uses YAML with human readable language, that results in scripts that are simple to understand and to learn.</li>\n<li>It’s a powerful tool that can be used to configure systems, deploy software, and orchestrate more advanced IT tasks such as continuous deployment, zero downtime rolling updates and even cloud provisioning.</li>\n<li>You won’t need to install an agent, because ansible is agentless, it will run with SSH or WinRM.</li>\n</ul>\n<h3 id=\"important-concepts-you-need-to-know\" style=\"position:relative;\"><a href=\"#important-concepts-you-need-to-know\" aria-label=\"important concepts you need to know permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Important concepts you need to know</h3>\n<ul>\n<li>Ansible Playbooks - Basically, Ansible Playbooks are an unit of scripts that defines a desired state.</li>\n<li>Inventory - Inventories are a list of managed nodes (network devices/servers) that you will target when running your scripts.</li>\n<li>Modules - Modules are unit of codes that will be executed on your YAML scripts.</li>\n</ul>\n<h2 id=\"lets-start\" style=\"position:relative;\"><a href=\"#lets-start\" aria-label=\"lets start permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Let’s start</h2>\n<p>First you will install Ansible on your machine (called control node on Ansible documentation), then you will create an inventory, connect with them, copy the modules to the remote machines and execute.</p>\n<p>To install Ansible refer to the <a href=\"%5Bhttps://docs.ansible.com/ansible/latest/installation_guide/index.html%5D(https://docs.ansible.com/ansible/latest/installation_guide/index.html)\">documentation</a>.</p>\n<h3 id=\"creating-an-ansible-inventory\" style=\"position:relative;\"><a href=\"#creating-an-ansible-inventory\" aria-label=\"creating an ansible inventory permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating an Ansible inventory</h3>\n<p>By default the Ansible inventory is organized on <code class=\"language-text\">/etc/ansible/hosts</code>, you can create your inventory in a INI file or YAML file. I will be creating a INI file to organize my inventory and subcategories inside it that are Ansible groups, in a way to organize our inventory:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">[</span>service1<span class=\"token punctuation\">]</span>\nwebserver<span class=\"token punctuation\">-</span>z\n<span class=\"token punctuation\">[</span>service2<span class=\"token punctuation\">]</span>\nwebserver<span class=\"token punctuation\">-</span>x\nwebserver<span class=\"token punctuation\">-</span>y\n<span class=\"token punctuation\">[</span>linux_servers<span class=\"token punctuation\">:</span>children<span class=\"token punctuation\">]</span>\nservice1\nservice2</code></pre></div>\n<p>So, in this example I created 3 managed nodes that are separated in 2 Ansible groups, and there are the default groups that are “all” nodes and “ungrouped” nodes. And besides that I created a nested group <code class=\"language-text\">linux_servers:children</code>, that is pointing to the servers of other groups.</p>\n<p>Another thing that can be configured on the inventory are variables that normally are the variables used to connect with your nodes. For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">[</span>service1<span class=\"token punctuation\">]</span>\nwebserver<span class=\"token punctuation\">-</span>z\nwebserver<span class=\"token punctuation\">-</span>w\nwebserver<span class=\"token punctuation\">-</span>x ansible_password=&lt;override_var_password<span class=\"token punctuation\">></span>\n<span class=\"token punctuation\">[</span>service1<span class=\"token punctuation\">:</span>vars<span class=\"token punctuation\">]</span>\nansible_username=&lt;user<span class=\"token punctuation\">></span>\nansible_password=&lt;password<span class=\"token punctuation\">></span></code></pre></div>\n<p>A good practice is when creating variables to use colon to reference the group of nodes that are being referenced by the variables, and I included on this example one variable password on the node “webserver-x” that is using a different password, so you can override the defined variable for this specific node. You can define variables for nested groups as well.</p>\n<p>Basically in the end, using what we learned, the file will look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">[</span>service1<span class=\"token punctuation\">]</span>\nwebserver<span class=\"token punctuation\">-</span>x\nwebserver<span class=\"token punctuation\">-</span>y\n<span class=\"token punctuation\">[</span>service2<span class=\"token punctuation\">]</span>\nwebserver<span class=\"token punctuation\">-</span>p\nwebserver<span class=\"token punctuation\">-</span>g\nwebserver<span class=\"token punctuation\">-</span>f\n<span class=\"token punctuation\">[</span>linux_servers<span class=\"token punctuation\">:</span>children<span class=\"token punctuation\">]</span>\nservice1\nservice2\n<span class=\"token punctuation\">[</span>linux_servers<span class=\"token punctuation\">:</span>vars<span class=\"token punctuation\">]</span>\nansible_user=&lt;user<span class=\"token punctuation\">></span>\nansible_password=&lt;password<span class=\"token punctuation\">></span></code></pre></div>\n<p>So, to test if everything is working we can run a ping on our inventory, <code class=\"language-text\">ansible linux_servers -m ping</code>, this will run a module called ping on our nested group <code class=\"language-text\">linux_servers</code> using shared variables of the nested group.</p>\n<h2 id=\"writing-ansible-playbooks\" style=\"position:relative;\"><a href=\"#writing-ansible-playbooks\" aria-label=\"writing ansible playbooks permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Writing Ansible playbooks</h2>\n<p>First you will need to understand what is a module, a module can be defined as a code that will execute some logic, if you have familiarity with programming, module can be interpreted as a function, and as well they can be used with arguments. Modules can be called on the command like we did above with the <code class=\"language-text\">ping</code> module and can be defined inside the playbooks.</p>\n<p>One important aspect of Ansible modules are that they are idempotent, so if you run the same module again and again you will always have the same final result (the desired one), and if it sees that the desired state is already achieved it will not try to execute again or give an error.</p>\n<p>So, what’s an ansible playbook, a playbook can be defined as a unit of tasks (modules) to create a desired state. Playbooks are written on YAML, and can contain variables, list of hosts, groups and tasks. One example of a playbook can be:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> linux_servers\n  <span class=\"token key atrule\">vars</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">message</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Hello World!\"</span>\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Print First Message\n      <span class=\"token key atrule\">debug</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">msg</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">{</span> message <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>So, as defined above, this playbook will target the nodes of our ansible inventory in the group <code class=\"language-text\">linux_servers</code>, after that it will define the variable <code class=\"language-text\">message</code> and finally will run the debug module printing our variable. So the characteristics of a playbook is that they will always run in order to top to the bottom, the main responsibility of a task is to execute a module given arguments and variables passed in and can be defined a <code class=\"language-text\">name</code> to create a more readable script.</p>\n<p>So let’s create a real Ansible Playbook to install apache on our Linux servers:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> linux_servers\n  <span class=\"token key atrule\">become</span><span class=\"token punctuation\">:</span> yes\n  <span class=\"token key atrule\">tasks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Ensute that Apache2 is installed\"</span>\n      <span class=\"token key atrule\">apt</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> apache2\n        <span class=\"token key atrule\">state</span><span class=\"token punctuation\">:</span> latest</code></pre></div>\n<p>In this playbook the only feature that I used and we didn’t learned is <code class=\"language-text\">become</code> that will escalate the privileges (become a super user) on our playbook</p>\n<h3 id=\"create-runbooks-for-your-team\" style=\"position:relative;\"><a href=\"#create-runbooks-for-your-team\" aria-label=\"create runbooks for your team permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create runbooks for your team</h3>\n<p>After you know a little more about the Ansible, you can start creating playbooks to share with your team, and you can use some other tools like <a href=\"%5Bhttps://www.rundeck.com/%5D(https://www.rundeck.com/)\">RunDeck</a> and <a href=\"%5Bhttps://www.ansible.com/products/tower%5D(https://www.ansible.com/products/tower)\">Ansible Tower</a>.</p>\n<p>Another thing that can be created is a project for your team, to create a better organization for your playbooks, you should first read more about <a href=\"%5Bhttps://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html%5D(https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html)\">Ansible Roles</a> that is a way of grouping content to allow easy sharing with others.</p>\n<h3 id=\"alternatives-tools\" style=\"position:relative;\"><a href=\"#alternatives-tools\" aria-label=\"alternatives tools permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Alternatives tools</h3>\n<ul>\n<li>Puppet</li>\n<li>Chef</li>\n<li>Salt</li>\n</ul>\n<h3 id=\"for-more-information\" style=\"position:relative;\"><a href=\"#for-more-information\" aria-label=\"for more information permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>For more information</h3>\n<ul>\n<li><a href=\"%5Bhttps://docs.ansible.com/ansible/latest/user_guide/quickstart.html%5D(https://docs.ansible.com/ansible/latest/user_guide/quickstart.html)\">Oficial documentation</a></li>\n</ul>","fields":{"slug":"/posts/gettins-started-with-ansible","tagSlugs":["/tag/dev-ops/","/tag/ansible/"]},"frontmatter":{"date":"2020-05-25T01:33:49.000Z","description":"Ansible is a open source tool backed by red hat since 2015, that gives you the skill to control and configure multiple server from one single location. So, instead of having to go to each server and configure them, you can create automations with Ansible to do that for you. The benefits of Ansible are that...","tags":["DevOps","Ansible"],"title":"Getting started with Ansible","socialImage":"/media/image-2.jpg"}}},"pageContext":{"slug":"/posts/gettins-started-with-ansible"}}}