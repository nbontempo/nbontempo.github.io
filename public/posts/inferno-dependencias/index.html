<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>O inferno das dependÃªncias - Nicolas Bontempo</title>
  
  <meta name="description" content="Ferramentas, bibliotecas e frameworks que usamos hoje para construir nossas aplicaÃ§Ãµes web sÃ£o drasticamente diferentes daquelas usadas a poucos anos atrÃ¡s.
Em poucos anos, muitas dessas tecnologias mudarÃ£o novamente. Mesmo assim, muitos de nÃ³s utilizamos essas tecnologias como uma parte central, inseparÃ¡vel dos nossos aplicativos.
NÃ³s importamos, usamos e herdamos a framework do mÃªs como se elas todas fossem ficar inalteradas para sempre. SÃ³ que elas nÃ£o vÃ£o. E esse Ã© o problema.">
  <meta name="author" content="Nicolas Bontempo">
  
  <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i" rel="stylesheet">
  <link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
  
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
  <link rel="icon" href="/img/favicon.ico">
  
  <meta name="generator" content="Hugo 0.40.3">
  
  <link rel="alternate" type="application/atom+xml" href="/index.xml" title="Nicolas Bontempo">
</head>
<body class="single">
  <header class="header">
    
    <p class="title"><a href="/"><span>ğŸ±â€ğŸ‘“</span>Nicolas Bontempo</a></p>
    
    <button class="menu-toggle" type="button"></button>
    <nav class="menu">
      <ul>
        
        
        <li class="">
          <a href="https://github.com/nickbom">Github</a>
        </li>
        
        <li class="">
          <a href="https://www.linkedin.com/in/nicolasbontempo">Linkedin</a>
        </li>
        
        <li class="">
          <a href="/sobre/">Sobre o autor</a>
        </li>
        
      </ul>
    </nav>
  </header>
  <main class="main">

<article class="post post-view">
  <header class="post-header">
    <h1 class="post-title">O inferno das dependÃªncias</h1>
    <p class="post-meta">Nicolas Bontempo Â· 26/11/2016<div style="color:grey; font-size:16px;">
        <strong>Tags:</strong> 
        <a href="/%20/tags/%20depend%C3%AAncias">dependÃªncias</a> 
        <a href="/%20/tags/%20bibliotecas">bibliotecas</a> 
        <a href="/%20/tags/%20frameworks">frameworks</a> 
      </div>
    </p>
  </header>
  <div class="post-content">

<p>Ferramentas, bibliotecas e frameworks que usamos hoje para construir nossas aplicaÃ§Ãµes web sÃ£o drasticamente diferentes daquelas usadas a poucos anos atrÃ¡s.</p>

<p>Em poucos anos, muitas dessas tecnologias mudarÃ£o novamente. Mesmo assim, muitos de nÃ³s utilizamos essas tecnologias como uma parte central, inseparÃ¡vel dos nossos aplicativos.</p>

<p>NÃ³s importamos, usamos e herdamos a framework do mÃªs como se elas todas fossem ficar inalteradas para sempre. SÃ³ que elas nÃ£o vÃ£o. E esse Ã© o problema.</p>

<p>Depois de algum tempo em desenvolvimento, design e arquitetura de web apps. Eu encontrei duas importantes verdades:</p>

<p>1- DependÃªncias externas representam uma grande ameaÃ§a Ã  estabilidade a longo prazo e a viabilidade de qualquer aplicaÃ§Ã£o.</p>

<p>2- Ã‰ cada vez mais difÃ­cil, se nÃ£o impossÃ­vel, construir qualquer tipo de aplicaÃ§Ã£o nÃ£o trivial sem importar dependÃªncias externas.</p>

<p>Esse artigo trata de reconciliar essas duas verdades, para que os nossos aplicativos tenham uma chance de sobrevivÃªncia em longo prazo.</p>

<h3 id="o-buraco-Ã©-muito-fundo-certamente">O buraco Ã© muito fundo certamente</h3>

<p>Se comeÃ§armos pensando todas as coisas que nossa aplicaÃ§Ã£o web depende, Ã© fÃ¡cil pensar em uma duzia de coisas ou mais, antes de chegar ao cÃ³digo:</p>

<ul>
<li>Energia elÃ©trica</li>
<li>ConexÃ£o a internet</li>
<li>Firewall</li>
<li>DNS</li>
<li>Hardware do servidor</li>
<li>Resfriamento</li>
<li>Plataforma de virtualizaÃ§Ã£o</li>
<li>Plataforma de container</li>
<li>Sistema operacional</li>
<li>Plataforma do web server</li>
<li>Plataforma do app server</li>
<li>Navegador web</li>
</ul>

<p>Como desenvolvedor, Ã© bom ficar conectado a esse tipo de coisa, mas nÃ£o temos muito o que fazer em relaÃ§Ã£o a elas. Assim, vamos ignora-las por agora e conversar apenas sobre o cÃ³digo.</p>

<p>No cÃ³digo, temos trÃªs tipos de dependÃªncias:</p>

<ol>
<li><p>DependÃªncias que nÃ³s controlamos</p>

<p><code>CÃ³digo escrito e de propriedade da nossa organizaÃ§Ã£o.</code></p></li>

<li><p>DependÃªncias que nÃ³s nÃ£o controlamos</p>

<p><code>CÃ³digo escrito por um terceiro ou uma comunidade open source.</code></p></li>

<li><p>DependÃªncias removidas</p>

<p><code>Essas sÃ£o as dependÃªncias que as nossas dependÃªncias dependem.</code></p></li>
</ol>

<p>NÃ³s vamos falar principalmente das dependÃªncias que nÃ£o controlamos.</p>

<p>DependÃªncias que controlamos e dependÃªncias removidas tambÃ©m podem causar dor de cabeÃ§a, mas elas ainda podem ser resolvidos internamente. No caso das dependÃªncias que controlamos, temos que ser capazes de intervir e mitigar qualquer problema.</p>

<p>No caso de dependÃªncias removidas, nÃ³s podemos geralmente confiar em um terceiro para resolver o problema, uma vez que eles sÃ£o dependentes destes.</p>

<h3 id="porque-precisamos-usar-dependÃªncias-externas">Porque precisamos usar dependÃªncias externas?</h3>

<p>Uma grande porÃ§Ã£o das aplicaÃ§Ãµes web existem para resolver pequenos problemas: autenticaÃ§Ã£o, autorizaÃ§Ã£o, acesso de dados, tratamento de erros, navegaÃ§Ã£o, logging, encriptaÃ§Ã£o, mostrar lista de dados, validaÃ§Ã£o de formulÃ¡rios de entrada e muitos outros&hellip;.</p>

<p>Independente de quais tecnologias vocÃª usa, tem uma grande chance de que problemas comuns tenham uma soluÃ§Ã£o existente e estejam disponÃ­veis como uma biblioteca que vocÃª facilmente pode adquirir e plugar no seu cÃ³digo bÃ¡sico. Escrever qualquer coisa do zero Ã© geralmente uma perda de tempo.</p>

<p>VocÃª precisa concentrar no cÃ³digo para resolver problemas incomuns ou resolver um problema comum de uma maneira incomum. Isso Ã© o que torna uma aplicaÃ§Ã£o de valor: o cÃ³digo que implementa as regras de negÃ³cio que sÃ£o Ãºnicos ao seu aplicativo, o diferencial da sua aplicaÃ§Ã£o (o seu <code>tempero secreto</code>).</p>

<p>A busca do google e seu algoritmo de page rank, o filtro da timeline do facebook, a seÃ§Ã£o de recomendaÃ§Ã£o do netflix e algoritmos de compressÃ£o, todo o cÃ³digo atrÃ¡s dessas funcionalidades sÃ£o o <code>tempero secreto</code> por trÃ¡s desses produtos.</p>

<p>CÃ³digos de terceiros em forma de bibliotecas, possibilita que vocÃª implemente rapidamente essas funcionalidades comuns no seu aplicativo, para que vocÃª sempre se foque no seu <code>tempero secreto</code>.</p>

<h3 id="porque-dependÃªncias-de-terceiros-sÃ£o-ruins">Porque dependÃªncias de terceiros sÃ£o ruins</h3>

<p>Olhe um pouco para um web app nÃ£o trivial construÃ­do nos Ãºltimos anos e vocÃª ficarÃ¡ absolutamente surpreso com a quantidade de cÃ³digo vindo de bibliotecas de terceiros, acesse qualquer website utilizando o plugin <a href="https://wappalyzer.com/">Wappalyzer</a> e vocÃª ficarÃ¡ assustado com o nÃºmero de bibliotecas utilizadas nas aplicaÃ§Ãµes web. E se uma dessas bibliotecas de terceiros <a href="https://daveceddia.com/angular-2-should-you-upgrade/">muda drasticamente</a>, ou <a href="http://blog.parse.com/announcements/moving-on/">desaparece</a>, ou <a href="http://www.theregister.co.uk/2016/03/23/npm_left_pad_chaos/">quebra</a>?</p>

<p>Se Ã© um projeto de cÃ³digo aberto, pelo menos vocÃª pode concertar por si mesmo. Mas quÃ£o bem vocÃª vai entender todo o cÃ³digo naquela biblioteca que vocÃª nÃ£o possui? Uma grande razÃ£o do porque vocÃª usa uma biblioteca em primeiro lugar Ã© conseguir os benefÃ­cios do cÃ³digo sem ter que se importar com detalhes. Mas agora vocÃª estÃ¡ preso. VocÃª gastou uma fortuna nessa dependÃªncia, que vocÃª nÃ£o possui e nÃ£o controla.</p>

<p>Tenho uma boa historia que pode elucidar um pouco das consequÃªncias de uma dependÃªncia mÃ¡ escolhida. Uma empresa construiu um aplicativo usando um provedor de backend-as-a-service. Utilizando de uma biblioteca provida pelo serviÃ§o para consumir o mesmo. No processo, eles amarraram algumas partes do seu cÃ³digo com a biblioteca, incluindo o seu <code>tempero secreto</code>.</p>

<p>TrÃªs meses depois do lanÃ§amento do produto da empresa, justamente quando ele havia comeÃ§ado a receber alguma traÃ§Ã£o no negÃ³cio com clientes pagantes, o serviÃ§o de backend-as-a-service anunciou que iria ser desligado.</p>

<p>Agora ao invÃ©s de focar na iteraÃ§Ã£o do produto e crescer a sua base de consumidores, a empresa teve que descobrir se eles migravam para uma plataforma hospedada por eles mesmos, uma versÃ£o open source do projeto, ou substituir completamente o serviÃ§o.</p>

<p>A interrupÃ§Ã£o que isso causou para uma aplicaÃ§Ã£o jovem e incipiente foi tÃ£o grande que a empresa acabou com o app completamente.</p>

<h3 id="balanceando-as-consequÃªncias-e-os-benefÃ­cios">Balanceando as consequÃªncias e os benefÃ­cios</h3>

<p>Minha antiga soluÃ§Ã£o para conter os riscos e colher os benefÃ­cios das bibliotecas Ã© utilizar o <a href="https://en.wikipedia.org/wiki/Adapter_pattern">Adapter Pattern</a>.</p>

<p>Essencialmente, vocÃª coloca cÃ³digos de terceiros em uma classe adapter ou um mÃ³dulo que vocÃª escreveu. Isso entÃ£o funciona de uma forma que vocÃª consiga isolar o cÃ³digo de terceiros de uma maneira que vocÃª controle.</p>

<p>Utilizando esse padrÃ£o, se uma biblioteca de terceiro ou uma framework muda, ou vai embora, vocÃª precisa mudar apenas o cÃ³digo dentro do adapter. O resto do seu aplicativo continua intacto.</p>

<p>Isso soa bem no papel. Quando vocÃª possui dependÃªncias auto contidas que provem apenas poucas funcionalidades, isso vai resolver o problema. Mas coisas podem ficar feias rapidamente.</p>

<p>VocÃª pode imaginar ter que incluir a biblioteca Angular 2 antes de usar qualquer coisa do mesmo? Que tal incluir jQuery, ou Angular, ou a Framework Spring em java? Rapidamente isso pode se tornar um pesadelo.</p>

<p>Existe uma melhor abordagem para o problema com tantas dependÃªncias&hellip;</p>

<p>Para cada dependÃªncia que vocÃª deseja adicionar na base do seu cÃ³digo, Ã© necessÃ¡rio avaliar o nÃ­vel de risco que serÃ¡ introduzido multiplicando dois fatores:</p>

<ol>
<li>A probabilidade de que a dependÃªncia vai mudar de forma material.</li>
<li>A quantia de dano que uma mudanÃ§a material na dependÃªncia vai fazer com a sua aplicaÃ§Ã£o.</li>
</ol>

<p>Uma biblioteca de terceiros tem menor probabilidade de mudar quando algumas dessas prerrogativas seguintes sÃ£o verdadeiras:</p>

<ul>
<li>Ela estÃ¡ entre nÃ³s por alguns anos e teve grandes releases.</li>
<li>Ã‰ usada por muitas aplicaÃ§Ãµes comerciais.</li>
<li>Tem um suporte ativo de grandes organizaÃ§Ãµes, preferencialmente um nome familiar de empresa ou instituiÃ§Ã£o.</li>
</ul>

<p>Possuir apenas popularidade nÃ£o Ã© uma prerrogativa, veja o <a href="https://github.com/angular/angular">angular</a> por exemplo. AlÃ©m de controlar a probabilidade de mudanÃ§a, devemos controlar tambÃ©m os danos que podem ser causados, uma biblioteca de terceiro ou framework vai causar menos dano em sua aplicaÃ§Ã£o quando algumas ou todas as prerrogativas seguintes sÃ£o verdadeiras:</p>

<ul>
<li>Ela foi usada apenas em pequenas partes da sua aplicaÃ§Ã£o, em vez de ser usada por toda parte.</li>
<li>O cÃ³digo que depende da biblioteca, nÃ£o Ã© o <code>tempero secreto</code>.</li>
<li>Remove-lo requer pequenas mudanÃ§as no seu cÃ³digo base.</li>
<li>Sua aplicaÃ§Ã£o Ã© muito pequena e pode ser reescrita rapidamente (Seja cuidados com essa, ela serÃ¡ verdade apenas por pouco tempo provavelmente)</li>
</ul>

<p>O quanto mais ariscado algo for, mais provÃ¡vel que vocÃª deva isolÃ¡-lo ou evitÃ¡-lo de qualquer forma.</p>

<p>Quando conversamos sobre o cÃ³digo que Ã© a proporÃ§Ã£o central da sua aplicaÃ§Ã£o, o <code>tempero secreto</code>, vocÃª precisa ser extremamente cuidado e protecionista. Fazer um cÃ³digo extremamente independente quanto possÃ­vel. Se vocÃª absolutamente precisa usar uma dependÃªncia, considerar injetar ela, ao contrÃ¡rio de referenciar a mesma diretamente. Mesmo assim, seja cuidadoso.</p>

<p>Algumas vezes isso significa &lsquo;nÃ£o&rsquo; para uma biblioteca de terceiros que vocÃª pensa ser realmente muito legal, ou que vocÃª queira muito usar por uma razÃ£o ou outra. Seja forte. Acredite, vai pagar. Apenas pergunte para quem investiu pesado no primeiro lanÃ§amento de angular, ou a empresa que perdeu a aplicaÃ§Ã£o. NÃ£o foi divertido. Acredite.</p>

<p>Outra forma de visualizar as dependÃªncias de outra maneira Ã© gerar um grafo de dependÃªncias para as suas aplicaÃ§Ãµes, Ã© uma boa forma de entender o nÃ­vel de risco introduzido pelas suas dependÃªncias. Existem ferramentas gratuitas para fazer isso em diversas linguagens.</p>
</div>
  <footer class="post-footer">
    
    <ul class="post-tags">
      
      <li>
        <a href="/tags/depend%C3%AAncias/">dependÃªncias</a>
      </li>
      
      <li>
        <a href="/tags/bibliotecas/">bibliotecas</a>
      </li>
      
      <li>
        <a href="/tags/frameworks/">frameworks</a>
      </li>
      
    </ul>
    
  </footer>
  
   
  <div id="disqus_thread"></div>
  <script>
    var disqus_shortname = 'nicolasbontempo';
    (function () { 
      var d = document,
        s = d.createElement('script');
      s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
   
</article>
</main>
<footer class="footer">
  <span>&copy; 2015-2018 Nicolas Bontempo ğŸ‰</span>
</footer>
<script src="https://cdn.bootcss.com/instantclick/3.0.1/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js" data-no-instant></script>

<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-71553462-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

<script data-no-instant>
  hljs.initHighlightingOnLoad();
  menuToggle();
  InstantClick.on('change', function() {
    var blocks = document.querySelectorAll('pre code');
    for (var i = 0; i < blocks.length; i++) {
      hljs.highlightBlock(blocks[i]);
    }
    menuToggle();
  });
  function menuToggle() {
    var $toggle = document.querySelector('.menu-toggle');
    if (!$toggle.offsetParent) {
      return;
    }
    var $body = document.querySelector('body');
    $toggle.addEventListener('click', function() {
      $body.classList.toggle('noscroll');
    }, false);
  }
</script>
</body>
</html>
