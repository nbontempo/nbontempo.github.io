<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>Getting started with Ansible - Nicolas Bontempo</title>
  
  <meta name="description" content="Ansible is a open source tool backed by red hat since 2015, that gives you the skill to control and configure multiple server from one single location. So, instead of having to go to each server and configure them, you can create automations with Ansible to do that for you. The benefits of Ansible are that:
 Uses YAML with human readable language, that results in scripts that are simple to understand and to learn.">
  <meta name="author" content="Nicolas Bontempo">
  
  <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i" rel="stylesheet">
  <link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
  
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
  <link rel="icon" href="/img/favicon.ico">
  
  <link rel="alternate" type="application/atom+xml" href="/index.xml" title="Nicolas Bontempo">
</head>
<body class="single">
  <header class="header">
    
    <p class="title"><a href="/"><span>üê±‚Äçüëì</span>Nicolas Bontempo</a></p>
    
    <button class="menu-toggle" type="button"></button>
    <nav class="menu">
      <ul>
        
        
        <li class="">
          <a href="https://github.com/nickbom">Github</a>
        </li>
        
        <li class="">
          <a href="https://www.linkedin.com/in/nicolasbontempo">Linkedin</a>
        </li>
        
        <li class="">
          <a href="/posts/">Posts</a>
        </li>
        
        <li class="">
          <a href="/sobre/">Sobre o autor</a>
        </li>
        
      </ul>
    </nav>
  </header>
  <main class="main">

<article class="post post-view">
  <header class="post-header">
    <h1 class="post-title">Getting started with Ansible</h1>
    <p class="post-meta">Nicolas Bontempo ¬∑ 24/05/2020<div style="color:grey; font-size:16px;">
        <strong>Tags:</strong> 
        <a href="/%20/tags/%20devops">DevOps</a> 
        <a href="/%20/tags/%20ansible">Ansible</a> 
      </div>
    </p>
  </header>
  <div class="post-content"><p>Ansible is a open source tool backed by red hat since 2015, that gives you the skill to control and configure multiple server from one single location. So, instead of having to go to each server and configure them, you can create automations with Ansible to do that for you. The benefits of Ansible are that:</p>
<ul>
<li>Uses YAML with human readable language, that results in scripts that are simple to understand and to learn.</li>
<li>It&rsquo;s a powerful tool that can be used to configure systems, deploy software, and orchestrate more advanced IT tasks such as continuous deployment, zero downtime rolling updates and even cloud provisioning.</li>
<li>You won&rsquo;t need to install an agent, because ansible is agentless, it will run with SSH or WinRM.</li>
</ul>
<h3 id="important-concepts-you-need-to-know">Important concepts you need to know</h3>
<ul>
<li>Ansible Playbooks - Basically, Ansible Playbooks are an unit of scripts that defines a desired state.</li>
<li>Inventory - Inventories are a list of managed nodes (network devices/servers) that you will target when running your scripts.</li>
<li>Modules - Modules are unit of codes that will be executed on your YAML scripts.</li>
</ul>
<h2 id="lets-start">Let&rsquo;s start</h2>
<p>First you will install Ansible on your machine (called control node on Ansible documentation), then you will create an inventory, connect with them, copy the modules to the remote machines and execute.</p>
<p>To install Ansible refer to the <a href="%5Bhttps://docs.ansible.com/ansible/latest/installation_guide/index.html%5D(https://docs.ansible.com/ansible/latest/installation_guide/index.html)">documentation</a>.</p>
<h3 id="creating-an-ansible-inventory">Creating an Ansible inventory</h3>
<p>By default the Ansible inventory is organized on <code>/etc/ansible/hosts</code>, you can create your inventory in a INI file or YAML file. I will be creating a INI file to organize my inventory and subcategories inside it that are Ansible groups, in a way to organize our inventory:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[service1]</span>
<span style="color:#a6e22e">webserver-z</span>
<span style="color:#66d9ef">[service2]</span>
<span style="color:#a6e22e">webserver-x</span>
<span style="color:#a6e22e">webserver-y</span>
<span style="color:#66d9ef">[linux_servers:children]</span>
<span style="color:#a6e22e">service1</span>
<span style="color:#a6e22e">service2</span>
</code></pre></div><p>So, in this example I created 3 managed nodes that are separated in 2 Ansible groups, and there are the default groups that are &ldquo;all&rdquo; nodes and &ldquo;ungrouped&rdquo; nodes. And besides that I created a nested group <code>linux_servers:children</code>, that is pointing to the servers of other groups.</p>
<p>Another thing that can be configured on the inventory are variables that normally are the variables used to connect with your nodes. For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[service1]</span>
<span style="color:#a6e22e">webserver-z</span>
<span style="color:#a6e22e">webserver-w</span>
<span style="color:#a6e22e">webserver-x ansible_password</span><span style="color:#f92672">=</span><span style="color:#e6db74">&lt;override_var_password&gt;</span>
<span style="color:#66d9ef">[service1:vars]</span>
<span style="color:#a6e22e">ansible_username</span><span style="color:#f92672">=</span><span style="color:#e6db74">&lt;user&gt;</span>
<span style="color:#a6e22e">ansible_password</span><span style="color:#f92672">=</span><span style="color:#e6db74">&lt;password&gt;</span>
</code></pre></div><p>A good practice is when creating variables to use colon to reference the group of nodes that are being referenced by the variables, and I included on this example one variable password on the node &ldquo;webserver-x&rdquo; that is using a different password, so you can override the defined variable for this specific node. You can define variables for nested groups as well.</p>
<p>Basically in the end, using what we learned, the file will look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[service1]</span>
<span style="color:#a6e22e">webserver-x</span>
<span style="color:#a6e22e">webserver-y</span>
<span style="color:#66d9ef">[service2]</span>
<span style="color:#a6e22e">webserver-p</span>
<span style="color:#a6e22e">webserver-g</span>
<span style="color:#a6e22e">webserver-f</span>
<span style="color:#66d9ef">[linux_servers:children]</span>
<span style="color:#a6e22e">service1</span>
<span style="color:#a6e22e">service2</span>
<span style="color:#66d9ef">[linux_servers:vars]</span>
<span style="color:#a6e22e">ansible_user</span><span style="color:#f92672">=</span><span style="color:#e6db74">&lt;user&gt;</span>
<span style="color:#a6e22e">ansible_password</span><span style="color:#f92672">=</span><span style="color:#e6db74">&lt;password&gt;</span>
</code></pre></div><p>So, to test if everything is working we can run a ping on our inventory, <code>ansible linux_servers -m ping</code>, this will run a module called ping on our nested group <code>linux_servers</code> using shared variables of the nested group.</p>
<h2 id="writing-ansible-playbooks">Writing Ansible playbooks</h2>
<p>First you will need to understand what is a module, a module can be defined as a code that will execute some logic, if you have familiarity with programming, module can be interpreted as a function, and as well they can be used with arguments. Modules can be called on the command like we did above with the <code>ping</code> module and can be defined inside the playbooks.</p>
<p>One important aspect of Ansible modules are that they are idempotent, so if you run the same module again and again you will always have the same final result (the desired one), and if it sees that the desired state is already achieved it will not try to execute again or give an error.</p>
<p>So, what&rsquo;s an ansible playbook, a playbook can be defined as a unit of tasks (modules) to create a desired state. Playbooks are written on YAML, and can contain variables, list of hosts, groups and tasks. One example of a playbook can be:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#66d9ef">hosts</span>: linux_servers
  <span style="color:#66d9ef">vars</span>: 
    <span style="color:#66d9ef">message</span>: <span style="color:#e6db74">&#34;Hello World!&#34;</span>
  <span style="color:#66d9ef">tasks</span>:
  - <span style="color:#66d9ef">name</span>: Print First Message
    <span style="color:#66d9ef">debug</span>:
      <span style="color:#66d9ef">msg</span>: {{ message }}
</code></pre></div><p>So, as defined above, this playbook will target the nodes of our ansible inventory in the group <code>linux_servers</code>, after that it will define the variable <code>message</code> and finally will run the debug module printing our variable. So the characteristics of a playbook is that they will always run in order to top to the bottom, the main responsibility of a task is to execute a module given arguments and variables passed in and can be defined a <code>name</code> to create a more readable script.</p>
<p>So let&rsquo;s create a real Ansible Playbook to install apache on our Linux servers:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#66d9ef">hosts</span>: linux_servers
  <span style="color:#66d9ef">become</span>: yes
  <span style="color:#66d9ef">tasks</span>:
  - <span style="color:#66d9ef">name</span>: <span style="color:#e6db74">&#34;Ensute that Apache2 is installed&#34;</span>
    <span style="color:#66d9ef">apt</span>:
      <span style="color:#66d9ef">name</span>: apache2
      <span style="color:#66d9ef">state</span>: latest
</code></pre></div><p>In this playbook the only feature that I used and we didn&rsquo;t learned is <code>become</code> that will escalate the privileges (become a super user) on our playbook</p>
<h3 id="create-runbooks-for-your-team">Create runbooks for your team</h3>
<p>After you know a little more about the Ansible, you can start creating playbooks to share with your team, and you can use some other tools like <a href="%5Bhttps://www.rundeck.com/%5D(https://www.rundeck.com/)">RunDeck</a> and <a href="%5Bhttps://www.ansible.com/products/tower%5D(https://www.ansible.com/products/tower)">Ansible Tower</a>.</p>
<p>Another thing that can be created is a project for your team, to create a better organization for your playbooks, you should first read more about <a href="%5Bhttps://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html%5D(https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html)">Ansible Roles</a> that is a way of grouping content to allow easy sharing with others.</p>
<h3 id="alternatives-tools">Alternatives tools</h3>
<ul>
<li>Puppet</li>
<li>Chef</li>
<li>Salt</li>
</ul>
<h3 id="for-more-information">For more information</h3>
<ul>
<li><a href="%5Bhttps://docs.ansible.com/ansible/latest/user_guide/quickstart.html%5D(https://docs.ansible.com/ansible/latest/user_guide/quickstart.html)">Oficial documentation</a></li>
</ul>
</div>
  <footer class="post-footer">
    
    <ul class="post-tags">
      
      <li>
        <a href="/tags/devops/">DevOps</a>
      </li>
      
      <li>
        <a href="/tags/ansible/">Ansible</a>
      </li>
      
    </ul>
    
  </footer>
  
   
  <div id="disqus_thread"></div>
  <script>
    var disqus_shortname = 'nicolasbontempo';
    (function () { 
      var d = document,
        s = d.createElement('script');
      s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
   
</article>
</main>
<footer class="footer">
  <span>&copy; 2015-2020 Nicolas Bontempo üéâ</span>
</footer>
<script src="https://cdn.bootcss.com/instantclick/3.0.1/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js" data-no-instant></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-71553462-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script data-no-instant>
  hljs.initHighlightingOnLoad();
  menuToggle();
  InstantClick.on('change', function() {
    var blocks = document.querySelectorAll('pre code');
    for (var i = 0; i < blocks.length; i++) {
      hljs.highlightBlock(blocks[i]);
    }
    menuToggle();
  });
  function menuToggle() {
    var $toggle = document.querySelector('.menu-toggle');
    if (!$toggle.offsetParent) {
      return;
    }
    var $body = document.querySelector('body');
    $toggle.addEventListener('click', function() {
      $body.classList.toggle('noscroll');
    }, false);
  }
</script>
</body>
</html>
